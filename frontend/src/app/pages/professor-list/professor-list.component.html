<div class="container py-4">
  <div class="row align-items-center mb-3">
    <div class="col">
      <h1 class="h4 mb-0">Professores</h1>
    </div>
  </div>

  <form [formGroup]="filterForm" class="row g-3 mb-3">
    <div class="col-12 col-md-6 col-lg-4">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Buscar por nome</mat-label>
        <input matInput formControlName="searchTerm" placeholder="Digite o nome do professor">
        <button mat-icon-button matSuffix *ngIf="filterForm.get('searchTerm')?.value" (click)="clearSearch()" aria-label="Limpar busca">
          <mat-icon>close</mat-icon>
        </button>
        <mat-icon matSuffix *ngIf="!filterForm.get('searchTerm')?.value">search</mat-icon>
      </mat-form-field>
    </div>
    <div class="col-12 col-md-4 col-lg-3">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Filtrar por</mat-label>
        <mat-select formControlName="filterType">
          <mat-option *ngFor="let filter of filterOptions" [value]="filter.value">
            {{filter.viewValue}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="col-12 col-md-4 col-lg-3" *ngIf="isPeriodoFilterActive()">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Período letivo</mat-label>
        <input matInput formControlName="academicPeriod" placeholder="ex.: 2023.1">
      </mat-form-field>
    </div>
  </form>

  <div class="d-flex justify-content-center align-items-center py-5" *ngIf="isLoading">
    <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
  </div>

  <div class="card shadow-sm" [hidden]="isLoading">
    <div class="table-responsive">
      <table mat-table [dataSource]="dataSource" class="table align-middle mb-0">

      <!-- Photo Column -->
      <ng-container matColumnDef="photo">
        <th mat-header-cell *matHeaderCellDef class="text-uppercase small">Foto</th>
        <td mat-cell *matCellDef="let prof">
          <img [src]="prof.photoUrl || 'assets/images/default-avatar.png'" alt="{{prof.nomeCompleto}}" class="rounded-circle" style="width:40px;height:40px;object-fit:cover;">
        </td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="nomeCompleto">
        <th mat-header-cell *matHeaderCellDef class="text-uppercase small">Nome</th>
        <td mat-cell *matCellDef="let prof"> {{prof.nomeCompleto}} </td>
      </ng-container>

      <!-- Overall Rating Column -->
      <ng-container matColumnDef="notaGeral">
        <th mat-header-cell *matHeaderCellDef class="text-uppercase small">Nota Geral</th>
        <td mat-cell *matCellDef="let prof">
          <span *ngIf="prof.notaGeral !== undefined && prof.notaGeral !== null">
            {{prof.notaGeral | number:'1.1-1'}} <mat-icon class="star-icon">star_rate</mat-icon>
          </span>
          <span *ngIf="prof.notaGeral === undefined || prof.notaGeral === null">
            Not rated yet
          </span>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="text-uppercase small">Ações</th>
        <td mat-cell *matCellDef="let prof">
          <button mat-icon-button color="primary" (click)="viewProfessor(prof.id)" matTooltip="Ver detalhes">
            <mat-icon>visibility</mat-icon>
          </button>
          <!-- Add other actions like edit/delete for admin later -->
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true" class="table-light"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      
      <!-- Row shown when there is no matching data. -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell text-center py-3" [attr.colspan]="displayedColumns.length">
          Nenhum professor encontrado com os critérios informados.
        </td>
      </tr>
    </table>
    </div>

    <div class="p-3 border-top">
      <mat-paginator 
        [length]="totalElements" 
        [pageSize]="pageSize" 
        [pageSizeOptions]="[5, 10, 20, 50]"
        aria-label="Selecionar página de professores">
      </mat-paginator>
    </div>
  </div>

</div>