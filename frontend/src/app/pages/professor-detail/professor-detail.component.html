<!-- Loading State -->
<div *ngIf="isLoading" class="loading-container">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 text-center">
        <mat-spinner diameter="50"></mat-spinner>
        <p class="mt-3 text-muted">Carregando informações do professor...</p>
      </div>
    </div>
  </div>
</div>

<!-- Error State -->
<div *ngIf="errorMessage" class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-6">
      <div class="error-card">
        <div class="error-icon">
          <i class="bi bi-exclamation-triangle"></i>
        </div>
        <h3>Oops! Algo deu errado</h3>
        <p>{{ errorMessage }}</p>
        <button class="btn btn-primary" (click)="loadProfessorData()">
          <i class="bi bi-arrow-clockwise me-2"></i>
          Tentar Novamente
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Professor Content -->
<div *ngIf="!isLoading && professor" class="professor-page">
  <!-- Hero Section -->
  <div class="hero-section">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-3 text-center">
          <div class="professor-avatar">
            <img [src]="professor.photoUrl || 'assets/default-avatar.png'" 
                 [alt]="professor.nomeCompleto" 
                 class="avatar-image">
          </div>
        </div>
        <div class="col-md-9">
          <div class="professor-header">
            <h1 class="professor-name">{{ professor.nomeCompleto }}</h1>
            <div class="rating-section" *ngIf="professor.notaGeral">
              <div class="rating-display">
                <span class="rating-number">{{ professor.notaGeral | number:'1.1-1' }}</span>
                <div class="rating-stars">
                  <i class="bi bi-star-fill" *ngFor="let star of getStars(professor.notaGeral)"></i>
                  <i class="bi bi-star" *ngFor="let star of getEmptyStars(professor.notaGeral)"></i>
                </div>
              </div>
              <span class="rating-label">Avaliação Geral</span>
            </div>
            <div class="no-rating" *ngIf="!professor.notaGeral">
              <i class="bi bi-star me-2"></i>
              <span>Ainda não avaliado</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="container">
      <div class="row">
        <!-- Left Sidebar -->
        <div class="col-lg-4">
          <!-- Quick Stats Card -->
          <div class="stats-card">
            <h3 class="card-title">
              <i class="bi bi-graph-up me-2"></i>
              Estatísticas
            </h3>
            <div class="stats-grid">
              <div class="stat-item">
                <div class="stat-icon">
                  <i class="bi bi-book"></i>
                </div>
                <div class="stat-content">
                  <span class="stat-value">{{ professor.cadeiras.length || 0 }}</span>
                  <span class="stat-label">Disciplinas</span>
                </div>
              </div>
              <div class="stat-item">
                <div class="stat-icon">
                  <i class="bi bi-star"></i>
                </div>
                <div class="stat-content">
                  <span class="stat-value">{{ professor.notaGeral ? (professor.notaGeral | number:'1.1-1') : 'N/A' }}</span>
                  <span class="stat-label">Nota Geral</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Action Card -->
          <div class="action-card">
            <h3 class="card-title">
              <i class="bi bi-star-fill me-2"></i>
              Avaliação
            </h3>
            <p class="card-description">
              Compartilhe sua experiência e ajude outros estudantes a conhecerem melhor este professor.
            </p>
            <button class="btn btn-primary btn-evaluate" (click)="iniciarAvaliacao()">
              <i class="bi bi-rate_review me-2"></i>
              Avaliar Professor
            </button>
          </div>
        </div>

        <!-- Main Content Area -->
        <div class="col-lg-8">
          <!-- Disciplines Card -->
          <div class="content-card" *ngIf="professor.cadeiras && professor.cadeiras.length > 0">
            <div class="card-header">
              <h3 class="card-title">
                <i class="bi bi-journal-text me-2"></i>
                Disciplinas Ministradas
              </h3>
            </div>
            <div class="disciplines-grid">
              <div class="discipline-item" *ngFor="let cadeira of professor.cadeiras">
                <div class="discipline-icon">
                  <i class="bi bi-book-half"></i>
                </div>
                <div class="discipline-info">
                  <h5 class="discipline-name">{{ cadeira.nome }}</h5>
                  <div class="discipline-details">
                    <span class="badge badge-hours">{{ cadeira.cargaHoraria }}h</span>
                    <span class="badge" 
                          [ngClass]="cadeira.isEletiva ? 'badge-elective' : 'badge-mandatory'">
                      {{ cadeira.isEletiva ? 'Eletiva' : 'Obrigatória' }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Criteria Evaluation Card -->
          <div class="content-card" *ngIf="mockCriteriosWithComments && mockCriteriosWithComments.length > 0">
            <div class="card-header">
              <h3 class="card-title">
                <i class="bi bi-clipboard-check me-2"></i>
                Avaliação por Critério
              </h3>
            </div>
            <div class="criteria-list">
              <div class="criteria-item" *ngFor="let criterioMedia of mockCriteriosWithComments">
                <div class="criteria-main">
                  <div class="criteria-info">
                    <h5 class="criteria-name">
                      <a [routerLink]="['/professores', professor.id, 'criterios', criterioMedia.criterio.id, 'avaliacoes']" 
                         class="criteria-link">
                        {{ criterioMedia.criterio.nome }}
                      </a>
                    </h5>
                    <div class="criteria-rating">
                      <span class="rating-badge" 
                            [ngClass]="{
                              'badge-excellent': criterioMedia.mediaNotas >= 4.5,
                              'badge-good': criterioMedia.mediaNotas >= 3.5 && criterioMedia.mediaNotas < 4.5,
                              'badge-average': criterioMedia.mediaNotas >= 2.5 && criterioMedia.mediaNotas < 3.5,
                              'badge-poor': criterioMedia.mediaNotas < 2.5
                            }">
                        {{ criterioMedia.mediaNotas | number:'1.1-1' }}
                      </span>
                      <div class="rating-stars-small">
                        <i class="bi bi-star-fill" *ngFor="let star of getStars(criterioMedia.mediaNotas)"></i>
                        <i class="bi bi-star" *ngFor="let star of getEmptyStars(criterioMedia.mediaNotas)"></i>
                      </div>
                    </div>
                  </div>
                  <div class="criteria-comment" *ngIf="criterioMedia.topComentario">
                    <div class="comment-bubble">
                      <p class="comment-text">"{{ criterioMedia.topComentario.texto }}"</p>
                      <div class="comment-meta">
                        <span class="comment-author">{{ criterioMedia.topComentario.autor }}</span>
                        <div class="comment-votes">
                          <button class="vote-btn" 
                                  [ngClass]="{'active': criterioMedia.topComentario.userVote === 'positive'}"
                                  (click)="voteOnComment(criterioMedia.topComentario!, 'positive')">
                            <i class="bi bi-hand-thumbs-up"></i>
                            <span>{{ criterioMedia.topComentario.votosPositivos }}</span>
                          </button>
                          <button class="vote-btn" 
                                  [ngClass]="{'active': criterioMedia.topComentario.userVote === 'negative'}"
                                  (click)="voteOnComment(criterioMedia.topComentario!, 'negative')">
                            <i class="bi bi-hand-thumbs-down"></i>
                            <span>{{ criterioMedia.topComentario.votosNegativos }}</span>
                          </button>
                          <span class="net-votes">{{ getNetVotes(criterioMedia.topComentario) }} votos</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="criteria-comment" *ngIf="!criterioMedia.topComentario">
                    <div class="no-comment">
                      <i class="bi bi-chat-dots me-2"></i>
                      <span>Comentários disponíveis em breve</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- No Criteria Data -->
          <div class="content-card" *ngIf="!mockCriteriosWithComments || mockCriteriosWithComments.length === 0">
            <div class="empty-state">
              <div class="empty-icon">
                <i class="bi bi-clipboard-x"></i>
              </div>
              <h4>Ainda não há avaliações</h4>
              <p>Este professor ainda não foi avaliado por nenhum critério. Seja o primeiro a avaliar!</p>
              <button class="btn btn-primary" (click)="iniciarAvaliacao()">
                <i class="bi bi-star me-2"></i>
                Fazer Primeira Avaliação
              </button>
            </div>
          </div>

          <!-- General Comments Card -->
          <div class="content-card" *ngIf="mockGeneralComments && mockGeneralComments.length > 0">
            <div class="card-header">
              <h3 class="card-title">
                <i class="bi bi-chat-dots me-2"></i>
                Comentários Gerais
              </h3>
              <span class="comments-count">{{ mockGeneralComments.length }} comentários</span>
            </div>
            <div class="comments-section">
              <div class="comment-item" *ngFor="let comment of mockGeneralComments">
                <div class="comment-content">
                  <p class="comment-text">{{ comment.texto }}</p>
                  <div class="comment-footer">
                    <div class="comment-info">
                      <span class="comment-author">{{ comment.autor }}</span>
                      <span class="comment-date">{{ comment.dataComentario | date:'dd/MM/yyyy' }}</span>
                    </div>
                    <div class="comment-actions">
                      <button class="vote-btn" 
                              [ngClass]="{'active': comment.userVote === 'positive'}"
                              (click)="voteOnComment(comment, 'positive')"
                              title="Voto positivo">
                        <i class="bi bi-hand-thumbs-up"></i>
                        <span>{{ comment.votosPositivos }}</span>
                      </button>
                      <button class="vote-btn" 
                              [ngClass]="{'active': comment.userVote === 'negative'}"
                              (click)="voteOnComment(comment, 'negative')"
                              title="Voto negativo">
                        <i class="bi bi-hand-thumbs-down"></i>
                        <span>{{ comment.votosNegativos }}</span>
                      </button>
                      <span class="net-votes-display" 
                            [ngClass]="{
                              'positive': getNetVotes(comment) > 0,
                              'negative': getNetVotes(comment) < 0,
                              'neutral': getNetVotes(comment) === 0
                            }">
                        {{ getNetVotes(comment) >= 0 ? '+' : '' }}{{ getNetVotes(comment) }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Add Comment Button -->
              <div class="add-comment-section">
                <button class="btn btn-outline-primary">
                  <i class="bi bi-plus-circle me-2"></i>
                  Adicionar Comentário
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 